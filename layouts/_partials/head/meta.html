{{ $attrs := partial "functions/get-page-attrs.html" . }}

{{ with $attrs.urls.abs_url }}
    <link rel="canonical" href="{{ . }}">
{{ end }}

{{ with $attrs.site_title | plainify }}
    <meta name="name" content="{{ . }}">
{{ end }}

{{ with $attrs.author.name | default ($attrs.copyright_holder | default $attrs.site_title) }}
    <meta name="author" content="{{ . }}">
{{ end }}

{{ with $attrs.description | plainify | htmlUnescape }}
    <meta name="description" content="{{ trim . "\n\r\t " }}">
{{ end }}

{{ with $attrs.keywords }}
    <meta name="keywords" content="{{ delimit . ", " }}">
{{ end }}

{{ with $attrs.date_published }}
    <meta name="datePublished" content="{{ . }}">
{{ end }}

{{ with $attrs.date_modified }}
    <meta name="dateModified" content="{{ . }}">
{{ end }}

{{ with $attrs.urls.abs_url }}
    <meta name="url" content="{{ . }}">
{{ end }}

{{ with $attrs.author }}
    <meta name="publisher" content="{{ . }}">
{{ end }}

{{ with (replace $attrs.language_code "-" "_") }}
    <meta name="inLanguage" content="{{ . }}">
{{ end }}

{{ with $attrs.word_count }}
    <meta name="wordCount" content="{{ . }}">
{{ end }}

{{ range $key, $img := $attrs.images }}
    <meta name="image" content="{{ $img }}">
{{ end }}

<!-- Open Graph Meta Tags -->
<meta property="og:type" content="website">

{{ with $attrs.urls.abs_url }}
    <meta property="og:url" content="{{ . }}">
{{ end }}

{{ with $attrs.site_title }}
    <meta property="og:title" content="{{ . }}">
{{ end }}

{{ with $attrs.site_title }}
    <meta property="og:site_name" content="{{ . }}">
{{ end }}

{{ with $attrs.description }}
    <meta property="og:description" content="{{ . }}">
{{ end }}

{{ with (replace $attrs.language_code "-" "_") }}
    <meta property="og:locale" content="{{ . }}">
{{ end }}

{{ with $attrs.fb_admins }}
    <meta property="fb:admins" content="{{ . }}" />
{{ end }}

{{ range $key, $img := $attrs.images }}
    {{ if ne $key "tc_image" }}
        <meta property="og:image" content="{{ $img }}">
    {{ end }}
{{ end }}

{{ with $attrs.time_published }}
    <meta property="article:published_time" content="{{ . }}">
{{ end }}

{{ with $attrs.date_modified }}
    <meta property="article:modified_time" content="{{ . }}">
{{ end }}

{{ with $attrs.author }}
    <meta property="article:author" content="{{ . }}">
{{ end }}

{{ with $attrs.category }}
    <meta property="article:section" content="{{ . }}">
{{ end }}

{{ with $attrs.tags | default $attrs.keywords }}
    <meta property="article:tag" content="{{ delimit . ", " }}">
{{ end }}

<!-- Twitter Card Meta Tags -->
<meta name="twitter:card" content="summary_large_image">

{{ with $attrs.url }}
    <meta name="twitter:url" content="{{ . }}">
{{ end }}

{{ with $attrs.site_title }}
    <meta name="twitter:title" content="{{ . }}">
{{ end }}

{{ with $attrs.twitter_handle }}
    <meta name="twitter:site" content="@{{ . }}">
    <meta name="twitter:creator" content="@{{ . }}">
{{ end }}

{{ with $attrs.description }}
    <meta name="twitter:description" content="{{ . }}">
{{ end }}

{{ with $attrs.default_images.tc_image }}
    <meta name="twitter:image" content="{{ . }}">
{{ end }}

{{ $images := $attrs.images }}

{{ $schema := (dict
        "@context"          "https://schema.org"
        "@type"             "BlogPosting"
        "mainEntityOfPage"  (dict
            "@type" "WebPage"
            "@id" $attrs.urls.abs_url
        )
        "headline"          $attrs.page_title
        "description"       $attrs.description
        "image"             $images
        "author"            (dict
            "@type" "Person"
            "name" ($attrs.author.name | default ($attrs.copyright_holder | default $attrs.site_title))
            "url" $attrs.author.links.url
        )
        "publisher"         (dict
            "@type" "Organization"
            "name"  $attrs.site_title
            "logo"  (dict
                "@type" "ImageObject"
                "url" $attrs.default_images.site_logo
            )
        )
        "keywords"          (delimit $attrs.keywords ", ")
        "datePublished"     $attrs.date_published
        "dateModified"      $attrs.date_modified
        "articleSection"    $attrs.category
        "copyrightHolder"   $attrs.copyright_holder
        "copyrightYear"     $attrs.copyright_year
        ) }}
<script type="application/ld+json">
    {{ ($schema | jsonify (dict "prefix" "    " "indent" "    ")) | safeJS }}
</script>
